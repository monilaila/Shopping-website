<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout Page</title>
  <link rel="stylesheet" href="CSS/debug overlay.css"> 
  <link rel="stylesheet" href="CSS/colors.css">
  <link rel="stylesheet" href="CSS/debug overlay.css">  
  <script src="https://cdn.tailwindcss.com"></script>

</head>
<body class="bg-gray-100 min-h-screen">

  <!-- Top Bar -->
  <div onclick="history.back()" 
       class="w-full fixed top-0 left-0 bg-[var(--primary-color)] text-[var(--text-light)] shadow-md cursor-pointer">
    <div class="max-w-4xl mx-auto px-4 py-3 flex items-center">
      <span class="text-lg font-semibold">Anime Shop</span>
    </div>
  </div>

  <!-- Page Content -->
  <div class="pt-16 flex items-center justify-center">
    <div class="bg-white shadow-xl rounded-2xl w-full max-w-2xl p-8">
      <h2 class="text-2xl font-bold text-gray-800 mb-6">Checkout</h2>

      <form id="checkoutForm" class="space-y-5">
        <!-- Full Name -->
        <div>
          <label class="block text-gray-700 mb-1 font-medium">Full Name</label>
          <input id="fullName" type="text" placeholder="John Doe"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
        </div>

        <!-- Phone -->
        <div>
          <label class="block text-gray-700 mb-1 font-medium">Phone Number</label>
          <input id="phoneNumber" type="text" placeholder="+880 123 456 789"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
        </div>

        <!-- District Selector -->
        <div class="relative">
          <label class="block text-gray-700 mb-1 font-medium">জেলা</label>
          <button id="districtBtn" type="button"
            class="w-full flex justify-between items-center px-4 py-2 border rounded-full bg-gray-50 hover:bg-gray-100 focus:ring-2 focus:ring-indigo-500 focus:outline-none">
            <span id="districtText" class="text-gray-600">জেলা নির্বাচন করুন</span>
            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div id="districtMenu" 
               class="absolute z-10 mt-2 w-full max-h-60 overflow-y-auto bg-white shadow-lg rounded-xl hidden border">
            <ul id="districtList" class="divide-y"></ul>
          </div>
        </div>

        <!-- Upazila Selector -->
        <div class="relative">
          <label class="block text-gray-700 mb-1 font-medium">উপজেলা</label>
          <button id="upazilaBtn" type="button" disabled
            class="w-full flex justify-between items-center px-4 py-2 border rounded-full bg-gray-100 text-gray-500 focus:ring-2 focus:ring-indigo-500 focus:outline-none">
            <span id="upazilaText">প্রথমে জেলা নির্বাচন করুন</span>
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>
          <div id="upazilaMenu" 
               class="absolute z-10 mt-2 w-full max-h-60 overflow-y-auto bg-white shadow-lg rounded-xl hidden border">
            <ul id="upazilaList" class="divide-y"></ul>
          </div>
        </div>

        <!-- Street Address -->
        <div>
          <label class="block text-gray-700 mb-1 font-medium">Street Address</label>
          <input id="streetAddress" type="text" placeholder="123 Main St"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
        </div>

        <!-- Notes -->
        <div>
          <label class="block text-gray-700 mb-1 font-medium">Additional Notes (optional)</label>
          <textarea id="additionalNotes" placeholder="Leave delivery instructions..." rows="3"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"></textarea>
        </div>

        <!-- Coupon -->
        <div>
          <label class="block text-gray-700 mb-1 font-medium">Coupon Code (optional)</label>
          <input id="couponCode" type="text" placeholder="Enter coupon code"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none"/>
        </div>

        <!-- Confirm Button -->
        <div class="pt-4 ">
          <button type="submit"
            class="w-full bg-[var(--primary-color)] text-white font-semibold py-3 rounded-lg hover:bg-[var(--primary-hover-color)] transition">
            Confirm Order
          </button>
        </div>
      </form>
    </div>
  </div>



  <div id="loadingOverlay" class="hidden">
  <div class="loading-box">
    <div class="spinner"></div>
    <p>Processing your order...</p>
  </div>
</div>

<style>
#loadingOverlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
#loadingOverlay.hidden { display: none; }
.loading-box {
  background: #fff;
  padding: 20px 40px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}
.spinner {
  width: 40px;
  height: 40px;
  border: 5px solid #ddd;
  border-top: 5px solid var(--primary-color);
  border-radius: 50%;
  margin: 0 auto 15px;
  animation: spin 1s linear infinite;
}
@keyframes spin { 100% { transform: rotate(360deg); } }
</style>


<div id="successOverlay" class="hidden">
  <div class="success-box">
    <p>✅ Order Submitted Successfully!</p>
    <button onclick="document.getElementById('successOverlay').classList.add('hidden')" 
            class="ok-btn">OK</button>
  </div>
</div>

<style>
#successOverlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
#successOverlay.hidden { display: none; }
.success-box {
  background: #fff;
  padding: 20px 40px;
  border-radius: 10px;
  text-align: center;
  box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}
.success-box p {
  font-size: 18px;
  font-weight: 600;
  color: green;
}
.ok-btn {
  margin-top: 15px;
  background: var(--primary-color);
  color: white;
  padding: 8px 20px;
  border-radius: 8px;
}
.ok-btn:hover {
  background: var(--primary-hover-color);
}
</style>







 
 <script>
    const data = {
        "বাগেরহাট": ["বাগেরহাট সদর", "চিতলমারী", "ফকিরহাট", "কচুয়া", "মোল্লাহাট", "মোংলা", "মোড়েলগঞ্জ", "রামপাল", "শরণখোলা"],
        "বান্দরবান": ["আলীকদম", "বান্দরবান সদর", "লামা", "নাইক্ষ্যংছড়ি", "রোয়াংছড়ি", "রুমা", "থানচি"],
        "সিরাজগঞ্জ": ["বেলকুচি", "চৌহালী", "কামারখন্দ", "কাজীপুর", "রায়গঞ্জ", "শাহজাদপুর", "সিরাজগঞ্জ সদর", "তারাশ", "উল্লাপাড়া"],
        "সুনামগঞ্জ": ["বিশ্বম্ভরপুর", "ছাতক", "দিরাই", "ধর্মপাশা", "দোয়ারাবাজার", "জগন্নাথপুর", "জামালগঞ্জ", "সুরমা", "সুনামগঞ্জ সদর", "তাহিরপুর"],
        "সিলেট": ["বালাগঞ্জ", "বিয়ানীবাজার", "বিশ্বনাথ", "কোম্পানীগঞ্জ", "দক্ষিণ সুরমা", "ফেঞ্চুগঞ্জ", "গোলাপগঞ্জ", "গোয়াইনঘাট", "জৈন্তাপুর", "কানাইঘাট", "সিলেট সদর", "ওসমানীনগর"],
        "টাঙ্গাইল": ["বাসাইল", "ভুয়াপুর", "দেলদুয়ার", "ঘাটাইল", "গোপালপুর", "কালিহাতী", "মধুপুর", "মির্জাপুর", "নগরপুর", "সখিপুর", "টাঙ্গাইল সদর", "ধনবাড়ী"],
        "ঠাকুরগাঁও": ["বালিয়াডাঙ্গী", "হরিপুর", "পীরগঞ্জ", "রাণীশংকৈল", "ঠাকুরগাঁও সদর"]
    };

  const districtBtn = document.getElementById("districtBtn");
  const districtMenu = document.getElementById("districtMenu");
  const districtText = document.getElementById("districtText");
  const districtList = document.getElementById("districtList");

  const upazilaBtn = document.getElementById("upazilaBtn");
  const upazilaMenu = document.getElementById("upazilaMenu");
  const upazilaText = document.getElementById("upazilaText");
  const upazilaList = document.getElementById("upazilaList");

  let selectedDistrict = "";
  let selectedUpazila = "";

  // Populate District List
  Object.keys(data).sort().forEach(district => {
    const li = document.createElement("li");
    li.textContent = district;
    li.className = "px-4 py-2 hover:bg-indigo-100 cursor-pointer";
    districtList.appendChild(li);

    li.addEventListener("click", () => {
      selectedDistrict = district;
      districtText.textContent = district;
      districtMenu.classList.add("hidden");

      // Enable Upazila Selector
      upazilaBtn.disabled = false;
      upazilaBtn.classList.remove("bg-gray-100","text-gray-500");
      upazilaBtn.classList.add("bg-gray-50","hover:bg-gray-100","text-gray-700");
      upazilaText.textContent = "উপজেলা নির্বাচন করুন";

      // Populate Upazila List
      upazilaList.innerHTML = "";
      data[district].sort().forEach(upazila => {
        const uli = document.createElement("li");
        uli.textContent = upazila;
        uli.className = "px-4 py-2 hover:bg-indigo-100 cursor-pointer";
        upazilaList.appendChild(uli);

        uli.addEventListener("click", () => {
          selectedUpazila = upazila;
          upazilaText.textContent = upazila;
          upazilaMenu.classList.add("hidden");
        });
      });
    });
  });

  // Toggle dropdowns
  districtBtn.addEventListener("click", () => {
    districtMenu.classList.toggle("hidden");
  });
  upazilaBtn.addEventListener("click", () => {
    if (!upazilaBtn.disabled) {
      upazilaMenu.classList.toggle("hidden");
    }
  });

  // Close menus when clicking outside
  window.addEventListener("click", (e) => {
    if (!districtBtn.contains(e.target) && !districtMenu.contains(e.target)) {
      districtMenu.classList.add("hidden");
    }
    if (!upazilaBtn.contains(e.target) && !upazilaMenu.contains(e.target)) {
      upazilaMenu.classList.add("hidden");
    }
  });





// fetch success block,




document.addEventListener("DOMContentLoaded", () => {
  const saved = CartUtils.getCheckoutData();
  if (saved) {
    // ✅ Refill required text fields
    document.getElementById("fullName").value = saved.Name || "";
    document.getElementById("phoneNumber").value = saved.PhoneNumber || "";
    document.getElementById("streetAddress").value = saved.StreetAddress || "";

    // ❌ Do NOT refill optional fields
    // document.getElementById("additionalNotes").value = saved.AdditionalNotes || "";
    // document.getElementById("couponCode").value = saved.CouponCode || "";

    // Restore district & upazila
    if (saved.DistrictAndUpazila) {
      selectedDistrict = saved.DistrictAndUpazila.District || "";
      selectedUpazila = saved.DistrictAndUpazila.Upazila || "";


      if (selectedDistrict) {
        districtText.textContent = selectedDistrict;

        // Enable & populate upazila list again
        upazilaBtn.disabled = false;
        upazilaBtn.classList.remove("bg-gray-100","text-gray-500");
        upazilaBtn.classList.add("bg-gray-50","hover:bg-gray-100","text-gray-700");

        upazilaList.innerHTML = "";
        data[selectedDistrict].sort().forEach(up => {
          const uli = document.createElement("li");
          uli.textContent = up;
          uli.className = "px-4 py-2 hover:bg-indigo-100 cursor-pointer";
          upazilaList.appendChild(uli);

          uli.addEventListener("click", () => {
            selectedUpazila = up;
            upazilaText.textContent = up;
            upazilaMenu.classList.add("hidden");
          });
        });

        // Restore selected upazila text
        if (selectedUpazila) {
          upazilaText.textContent = selectedUpazila;
        }
      }
    }
  }
});


</script> 

 <script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxcWFddgIUHnWSoTFWUhkU17hGmdwKHgjnZxbdwf9UX9Vlb4CTQkkaDHEsE1b9c4KMB/exec";


document.getElementById("checkoutForm").addEventListener("submit", function(e) {
  e.preventDefault();

  // ✅ Collect cart + delivery + form data
  const cart = CartUtils.getCart();
  const delivery = CartUtils.getDeliveryChoice();
  const fullName = document.getElementById("fullName").value.trim();
  const phoneNumber = document.getElementById("phoneNumber").value.trim();
  const streetAddress = document.getElementById("streetAddress").value.trim();
  const additionalNotes = document.getElementById("additionalNotes").value.trim();
  const couponCode = document.getElementById("couponCode").value.trim();

  // Flatten cart into comma-separated for id/title/image/price
  const ids = cart.map(i => i.id).join(",");
  const titles = cart.map(i => i.title).join(",");
  const images = cart.map(i => (i.image ? i.image.split("/").pop() : "none")).join(",");
  const prices = cart.map(i => `$${i.price}`).join(",");

  // Products JSON (color, size, quantity)
  const products = JSON.stringify(cart.map(i => ({
    colorName: i.color || null,
    size: i.size || null,
    quantity: i.quantity
  })));

  // District & Upazila JSON
  const districtData = JSON.stringify([
    { District: selectedDistrict || "" },
    { Upazila: selectedUpazila || "" }
  ]);

  // Option Information JSON
  const optionInformation = JSON.stringify({
    AdditionalNotes: additionalNotes || "",
    CouponCode: couponCode || ""
  });

  // ✅ Build query string exactly like District & Upazila.html
  const params = new URLSearchParams({
    path: "Sheet1",   // change if needed
    action: "write",
    id: ids,
    title: titles,
    image: images,
    price: prices,
    myArea: delivery || "unknown",
    name: fullName,
    PhoneNumber: phoneNumber,
    StreetAddress: streetAddress,
    products,
    districtData,
    optionInformation
  });

  // ✅ Show loading overlay
  document.getElementById("loadingOverlay").classList.remove("hidden");

  // ✅ Send request
fetch(`${SCRIPT_URL}?${params.toString()}`)
  .then(res => res.text())
  .then(txt => {
    document.getElementById("loadingOverlay").classList.add("hidden");
    document.getElementById("successOverlay").classList.remove("hidden");

    // clear cart
    localStorage.removeItem("cart");
    CartUtils.updateCartCount();
  })
  .catch(err => {
    document.getElementById("loadingOverlay").classList.add("hidden");
    alert("❌ Error: " + err);
  });


  
    CartUtils.saveCheckoutData({
      Name: fullName,
      PhoneNumber: phoneNumber,
      DistrictAndUpazila: { District: selectedDistrict, Upazila: selectedUpazila },
      StreetAddress: streetAddress,
      AdditionalNotes: additionalNotes,
      CouponCode: couponCode
  });
 
 





});
</script> 





   <!-- Debug Overlay -->
   <!-- <div id="cartDebugPanel"></div>
   <script src="JS/cart-utils.js" defer></script> -->


</body>
</html>





